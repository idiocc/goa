# @goa/koa

[![npm version](https://badge.fury.io/js/%40goa%2Fkoa.svg)](https://npmjs.org/package/@goa/koa)

`@goa/koa` is the Koa web-sever compiled and optimised with _Google Closure Compiler_ so that it has 0 dependencies. The types are written as JSDoc and don't require installing typings, therefore they work not just with TypeScript-based editors and don't require downloading additional data.

```sh
yarn add @goa/koa
```

## Table Of Contents

- [Table Of Contents](#table-of-contents)
- [Types](#types)
  * [`_goa.Application`](#type-_goaapplication)
  * [`_goa.ContextDelegatedResponse`](#type-_goacontextdelegatedresponse)
  * [`_goa.BaseResponse`](#type-_goabaseresponse)
  * [`_goa.Response`](#type-_goaresponse)
  * [`_goa.ContextDelegatedRequest`](#type-_goacontextdelegatedrequest)
- [Copyright](#copyright)

<p align="center"><a href="#table-of-contents"><img src=".documentary/section-breaks/0.svg?sanitize=true"></a></p>

## Types

[`import('http').IncomingMessage`](https://nodejs.org/api/http.html#http_class_http_incomingmessage) __<a name="type-httpincomingmessage">`http.IncomingMessage`</a>__: The first argument to the 'request' event.

[`import('http').ServerResponse`](https://nodejs.org/api/http.html#http_response_socket) __<a name="type-httpserverresponse">`http.ServerResponse`</a>__: The second parameter to the 'request' event.

[`import('net').Socket`](https://nodejs.org/api/net.html#net_class_net_socket) __<a name="type-netsocket">`net.Socket`</a>__: The socket underlying the request.

[`import('url').URL`](https://nodejs.org/api/url.html#url_class_url) __<a name="type-urlurl">`url.URL`</a>__: Browser-compatible URL class, implemented by following the `WHATWG` URL Standard.

__<a name="type-_goaapplication">`_goa.Application`</a>__: The application interface.

|      Name       |       Type       |                                                                                                 Description                                                                                                  |
| --------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| proxy           | <em>boolean</em> | Whether the server is running behind a proxy.                                                                                                                                                                |
| subdomainOffset | <em>number</em>  | For example, if the domain is "tobi.ferrets.example.com": If `app.subdomainOffset` is not set, request.subdomains is `["ferrets", "tobi"]`. If `app.subdomainOffset` is 3, request.subdomains is `["tobi"]`. |

__<a name="type-_goacontextdelegatedresponse">`_goa.ContextDelegatedResponse`</a>__: The response API available via Context.

|       Name        |                                     Type                                      |                                                                                                                                                                                     Description                                                                                                                                                                                     |
| ----------------- | ----------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| __attachment*__   | <em>function(string): void</em>                                               | Set Content-Disposition header to "attachment" with optional `filename`.                                                                                                                                                                                                                                                                                                            |
| __redirect*__     | <em>function(string, string=): void</em>                                      | Perform a 302 redirect to `url`. The string "back" is special-cased to provide Referrer support, when Referrer is not present `alt` or "/" is used. _Examples_:<li>      `this.redirect('back')`</li><li>      `this.redirect('back', '/index.html')`</li><li>      `this.redirect('/login')`</li><li>      `this.redirect('http://google.com')`</li>                               |
| __remove*__       | <em>function(string): void</em>                                               | Remove header `field`.                                                                                                                                                                                                                                                                                                                                                              |
| __vary*__         | <em>function(string): void</em>                                               | Vary on `field`.                                                                                                                                                                                                                                                                                                                                                                    |
| __set*__          | <em>function((string \| Object), (string \| Array&lt;string&gt;)=): void</em> | Set header `field` to `val`, or pass an object of header fields. _Examples_:<li>      `this.set('Foo', ['bar', 'baz'])`</li><li>      `this.set('Accept', 'application/json')`</li><li>      `this.set({ Accept: 'text/plain', 'X-API-Key': 'tobi' })`.</li>                                                                                                                        |
| __append*__       | <em>function(string, (string \| Array&lt;string&gt;)): void</em>              | Append additional header `field` with value `val`. _Examples_:<li>      `this.append('Link', ['<http://localhost>', '<http://localhost:3000>'])`</li><li>      `this.append('Set-Cookie', 'foo=bar; Path=/; HttpOnly')`</li><li>      `this.append('Warning', '199 Miscellaneous warning')`</li>                                                                                    |
| __flushHeaders*__ | <em>function(): void</em>                                                     | Flush any set headers, and begin the body.                                                                                                                                                                                                                                                                                                                                          |
| __status*__       | <em>number</em>                                                               | Get/set response status code.                                                                                                                                                                                                                                                                                                                                                       |
| __message*__      | <em>string</em>                                                               | Get/set response status message.                                                                                                                                                                                                                                                                                                                                                    |
| __body*__         | <em>(string \| !Buffer \| !Object \| !stream.Stream)</em>                     | Get/set response body.                                                                                                                                                                                                                                                                                                                                                              |
| __length*__       | <em>number</em>                                                               | Return parsed response `Content-Length` when present. Set `Content-Length` field to `n`.                                                                                                                                                                                                                                                                                            |
| __type*__         | <em>string</em>                                                               | Return the response mime type void of parameters such as "charset". Set Content-Type response header with `type` through `mime.lookup()` when it does not contain a charset. _Examples_:<li>      `this.type = '.html'`</li><li>      `this.type = 'html'`</li><li>      `this.type = 'json'`</li><li>      `this.type = 'application/json'`</li><li>      `this.type = 'png'`</li> |
| __lastModified*__ | <em>Date</em>                                                                 | Get the Last-Modified date in Date form, if it exists. Set the Last-Modified date using a string or a Date. _Examples_:<li>      `this.response.lastModified = new Date()`</li><li>      `this.response.lastModified = '2013-09-13'`</li>                                                                                                                                           |
| __etag*__         | <em>string</em>                                                               | Get/Set the ETag of a response. This will normalize the quotes if necessary. _Examples_:<li>      `this.response.etag = 'md5hashsum'`</li><li>      `this.response.etag = '"md5hashsum"'`</li><li>      `this.response.etag = 'W/"123456789"'`</li>                                                                                                                                 |
| __headerSent*__   | <em>boolean</em>                                                              | Check if a header has been written to the socket.                                                                                                                                                                                                                                                                                                                                   |
| __writable*__     | <em>boolean</em>                                                              | Checks if the request is writable. Tests for the existence of the socket as _Node.JS_ sometimes does not set it.                                                                                                                                                                                                                                                                    |

__<a name="type-_goabaseresponse">`_goa.BaseResponse`</a>__: The additional API not available via Context.

|     Name     |                                             Type                                             |                                                                         Description                                                                          |
| ------------ | -------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| __socket*__  | <em><a href="#type-netsocket" title="The socket underlying the request.">net.Socket</a></em> | Return the request socket.                                                                                                                                   |
| __header*__  | <em>Object&lt;string, string&gt;</em>                                                        | Return response header (_OutgoingHttpHeaders_).                                                                                                              |
| __headers*__ | <em>Object&lt;string, string&gt;</em>                                                        | Return response header, alias as `response.header` (_OutgoingHttpHeaders_).                                                                                  |
| __is*__      | <em>function((string \| !Array&lt;string&gt;), ...string): (string \| boolean)</em>          | Check whether the response is one of the listed types. Pretty much the same as `this.request.is()`.                                                          |
| __get*__     | <em>function(string): string</em>                                                            | Return response header. _Examples_:<li>      `this.get('Content-Type')` =&gt; `"text/plain"`</li><li>      `this.get('content-type')` => `"text/plain"`</li> |

__<a name="type-_goaresponse">`_goa.Response`</a>__: The response object.

|     Name     |                                                           Type                                                           |              Description               |
| ------------ | ------------------------------------------------------------------------------------------------------------------------ | -------------------------------------- |
| __app*__     | <em><a href="#type-_goaapplication" title="The application interface.">_goa.Application</a></em>                         | The reference to the application.      |
| __ctx*__     | <em>_goa.Context</em>                                                                                                    | The reference to the context instance. |
| __request*__ | <em>_goa.Request</em>                                                                                                    | The reference to the request instance. |
| __req*__     | <em><a href="#type-httpincomingmessage" title="The first argument to the 'request' event.">http.IncomingMessage</a></em> | The message from the client.           |
| __res*__     | <em><a href="#type-httpserverresponse" title="The second parameter to the 'request' event.">http.ServerResponse</a></em> | The response from the server.          |

__<a name="type-_goacontextdelegatedrequest">`_goa.ContextDelegatedRequest`</a>__: The request API available via Context.

|         Name          |                                                                 Type                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| __acceptsLanguages*__ | <em>function((!Array&lt;string&gt; \| string)=, ...string): (string \| !Array&lt;string&gt; \| boolean)</em>                          | Return accepted languages or best fit based on `langs`. Given `Accept-Language: en;q=0.8, es, pt` an array sorted by quality is returned: `['es', 'pt', 'en']`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| __acceptsEncodings*__ | <em>function((!Array&lt;string&gt; \| string)=, ...string): (string \| !Array&lt;string&gt; \| boolean)</em>                          | Return accepted encodings or best fit based on `encodings`. Given `Accept-Encoding: gzip, deflate` an array sorted by quality is returned: `['gzip', 'deflate']`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| __acceptsCharsets*__  | <em>function((!Array&lt;string&gt; \| string)=, ...string): (string \| !Array&lt;string&gt; \| boolean)</em>                          | Return accepted charsets or best fit based on `charsets`. Given `Accept-Charset: utf-8, iso-8859-1;q=0.2, utf-7;q=0.5` an array sorted by quality is returned: `['utf-8', 'utf-7', 'iso-8859-1']`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| __accepts*__          | <em>function((!Array&lt;string&gt; \| string)=, ...string): (string \| !Array&lt;string&gt; \| boolean)</em>                          | Check if the given `type(s)` is acceptable, returning the best match when true, otherwise `undefined`, in which case you should respond with 406 "Not Acceptable".<br/><br/>      The `type` value may be a single mime type string such as "application/json", the extension name such as "json" or an array `["json", "html", "text/plain"]`. When a list or array is given the _best_ match, if any is returned.<br/><br/>      _Examples_:<li>      [Accept: text/html] `this.accepts('html') => "html"`</li><li>      [Accept: text/*, application/json]</li>        `this.accepts('html') => "html"`<br/>        `this.accepts('text/html') => "text/html"`<br/>        `this.accepts('json', 'text') => "json"`<br/>        `this.accepts('application/json') => "application/json"`<li>      [Accept: text/*, application/json]</li>        `this.accepts('image/png') => undefined`<br/>        `this.accepts('png') => undefined`<li>      [Accept: text/*;q=.5, application/json]</li>        `this.accepts(['html', 'json']) => "json"`<br/>        `this.accepts('html', 'json') => "json"` |
| __get*__              | <em>function(string): string</em>                                                                                                     | Return request header. The `Referrer` header field is special-cased, both `Referrer` and `Referer` are interchangeable. _Examples_:<li>      `this.get('Content-Type') => "text/plain"`</li><li>      `this.get('content-type') => "text/plain"`</li><li>      `this.get('Something') => undefined`</li>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| __is*__               | <em>function((!Array&lt;string&gt; \| string), ...string)</em>                                                                        | Check if the incoming request contains the "Content-Type" header field, and it contains any of the give mime `type`s. If there is no request body, `null` is returned. If there is no content type, `false` is returned. Otherwise, it returns the first `type` that matches.<br/><br/>      _Examples_:<li>      With Content-Type: text/html; charset=utf-8</li>        `this.is('html'); // => 'html'`<br/>        `this.is('text/html'); // => 'text/html'`<br/>        `this.is('text/*', 'application/json'); // => 'text/html'`<li>      When Content-Type is application/json</li>        `this.is('json', 'urlencoded'); // => 'json'`<br/>        `this.is('application/json'); // => 'application/json'`<br/>        `this.is('html', 'application/*'); // => 'application/json'`<br/>        `this.is('html'); // => false`                                                                                                                                                                                                                                                                  |
| __querystring*__      | <em>string</em>                                                                                                                       | Get/Set query string.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| __idempotent*__       | <em>boolean</em>                                                                                                                      | Check if the request is idempotent.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| __socket*__           | <em><a href="#type-netsocket" title="The socket underlying the request.">net.Socket</a></em>                                          | Return the request socket.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| __search*__           | <em>string</em>                                                                                                                       | Get the search string. Same as the querystring except it includes the leading ?. Set the search string. Same as `response.querystring=` but included for ubiquity.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| __method*__           | <em>string</em>                                                                                                                       | Get/Set request method.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| __query*__            | <em>(!Object \| string)</em>                                                                                                          | Get parsed query-string. Set query-string as an object.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| __path*__             | <em>string</em>                                                                                                                       | Get request pathname. Set pathname, retaining the query-string when present.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| __url*__              | <em>string</em>                                                                                                                       | Get/Set request URL.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| __accept*__           | <em>accepts.Accepts</em>                                                                                                              | Get accept object. Lazily memoized.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| __origin*__           | <em>string</em>                                                                                                                       | Get origin of URL.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| __href*__             | <em>string</em>                                                                                                                       | Get full request URL.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| __subdomains*__       | <em>!Array&lt;string&gt;</em>                                                                                                         | Return subdomains as an array.<br/><br/>      Subdomains are the dot-separated parts of the host before the main domain of the app. By default, the domain of the app is assumed to be the last two parts of the host. This can be changed by setting `app.subdomainOffset`. For example, if the domain is "tobi.ferrets.example.com":<li>      If `app.subdomainOffset` is not set, this.subdomains is `["ferrets", "tobi"]`.</li><li>      If `app.subdomainOffset` is 3, this.subdomains is `["tobi"]`.</li>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| __protocol*__         | <em>string</em>                                                                                                                       | Return the protocol string "http" or "https" when requested with TLS. When the proxy setting is enabled the "X-Forwarded-Proto" header is enabled the "X-Forwarded-Proto" header a reverse proxy that supplies https for you this may be enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| __host*__             | <em>string</em>                                                                                                                       | Parse the "Host" header field host and support X-Forwarded-Host when a proxy is enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| __hostname*__         | <em>string</em>                                                                                                                       | Parse the "Host" header field hostname and support X-Forwarded-Host when a proxy is enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| __URL*__              | <em><a href="#type-urlurl" title="Browser-compatible URL class, implemented by following the `WHATWG` URL Standard.">url.URL</a></em> | Get WHATWG parsed URL object.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| __header*__           | <em>!Object&lt;string, string&gt;</em>                                                                                                | Return request header.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| __headers*__          | <em>!Object&lt;string, string&gt;</em>                                                                                                | Return request header, alias as `request.header`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| __secure*__           | <em>boolean</em>                                                                                                                      | Short-hand for: `this.protocol == 'https'`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| __stale*__            | <em>boolean</em>                                                                                                                      | Check if the request is stale, aka "Last-Modified" and / or the "ETag" for the resource has changed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| __fresh*__            | <em>boolean</em>                                                                                                                      | Check if the request is fresh, aka Last-Modified and/or the ETag still match.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| __ips*__              | <em>!Array&lt;string&gt;</em>                                                                                                         | When `app.proxy` is `true`, parse the "X-Forwarded-For" ip address list. For example if the value were "client, proxy1, proxy2" you would receive the array `["client", "proxy1", "proxy2"]` where "proxy2" is the furthest down-stream.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| __ip*__               | <em>string</em>                                                                                                                       | Request remote address. Supports X-Forwarded-For when app.proxy is true.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

<p align="center"><a href="#table-of-contents"><img src=".documentary/section-breaks/1.svg?sanitize=true"></a></p>

## Copyright

The Koa web server by its [authors](https://github.com/koajs/koa).

---

<table>
  <tr>
    <th>
      <a href="https://artd.eco">
        <img src="https://raw.githubusercontent.com/wrote/wrote/master/images/artdeco.png" alt="Art Deco" />
      </a>
    </th>
    <th> <a href="https://artd.eco">Art Deco</a> for <a href="https://idio.cc">Idio</a> 2019</th>
    <th>
      <a href="https://idio.cc">
        <img src="https://avatars3.githubusercontent.com/u/40834161?s=100" width="100" alt="Idio" />
      </a>
    </th>
    <th>
      <a href="https://www.technation.sucks" title="Tech Nation Visa">
        <img src="https://raw.githubusercontent.com/artdecoweb/www.technation.sucks/master/anim.gif"
          alt="Tech Nation Visa" />
      </a>
    </th>
    <th><a href="https://www.technation.sucks">Tech Nation Visa Sucks</a></th>
  </tr>
</table>

<p align="center"><a href="#table-of-contents"><img src=".documentary/section-breaks/-1.svg?sanitize=true"></a></p>